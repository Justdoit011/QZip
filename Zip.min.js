/**QZip v1.0 150622**/var QZip;(function(n){var t;(function(t){var i=function(){function t(n,t){if(!n)throw new Error("Array buffer is empty.");this.index=0;this.length=n.length;this.data=n;this.offset=t&&t>0?t:0}return t.prototype.byteAt=function(n){return this.data[n]},t.prototype.checkOffset=function(n){this.checkIndex(this.index+n)},t.prototype.checkIndex=function(n){if(this.length<n||n<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+n+"). Corrupted zip ?");},t.prototype.setIndex=function(n,t){t&&(n-=this.offset);this.checkIndex(n);this.index=n},t.prototype.skip=function(n){this.setIndex(this.index+n)},t.prototype.lastIndexOfSignature=function(t,i,r){var u;i?i>=this.length&&(i=this.length-4):i=this.length-4;r?r<0&&(r=0):r=0;n.ZipFile.writeLog("Search signature: "+r+" to "+i);var f=t.charCodeAt(0),e=t.charCodeAt(1),o=t.charCodeAt(2),s=t.charCodeAt(3);for(u=i;u>=r;--u)if(this.data[u]===f&&this.data[u+1]===e&&this.data[u+2]===o&&this.data[u+3]===s)return n.ZipFile.writeLog("Signature found in "+(i-u+1)+" try."),u;return-1},t.prototype.readInt=function(n){var i=0,t;for(this.checkOffset(n),t=this.index+n-1;t>=this.index;t--)i=(i<<8)+this.byteAt(t);return this.index+=n,i>>>0},t.prototype.readInt64=function(){var n=this.readInt(4),t=this.readInt(4);return t===0?n:t*4294967296+n},t.prototype.readString=function(n){if(n===0)return"";var t=this.arrayLikeToString(this.data,this.index,this.index+n);return this.index+=n,t},t.prototype.readDate=function(){var n=this.readInt(4);return new Date((n>>25&127)+1980,(n>>21&15)-1,n>>16&31,n>>11&31,n>>5&63,(n&31)<<1)},t.prototype.arrayLikeToString=function(n,t,i){var r=65536,s=[],e=i,u=t,h=!0,o,f;try{String.fromCharCode.apply(null,new Uint8Array(0))}catch(c){h=!1}if(!h){for(o="",f=u;f<e;f++)o+=String.fromCharCode(n[f]);return o}while(u<e&&r>1)try{s.push(String.fromCharCode.apply(null,n.subarray(u,Math.min(u+r,e))));u+=r}catch(c){r=Math.floor(r/2)}return s.join("")},t.prototype.dispose=function(){this.data&&(this.data=null)},t.MAX_VALUE_32BITS=4294967295,t}();t.BinaryReader=i})(t=n.Internal||(n.Internal={}))})(QZip||(QZip={})),function(n){var t;(function(n){var t=function(){function t(n,t){this.zip64=!1;this.isDir=!1;this.zip64=t;this.readCentralPart(n)}return t.prototype.readCentralPart=function(t){t.skip(4);this.bitFlag=t.readInt(2);t.skip(2);this.date=t.readDate();t.skip(8);this.uncompressedSize=t.readInt(4);var r=t.readInt(2),i=t.readInt(2),u=t.readInt(2);if(t.skip(12),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=t.readString(r);this.fileName=this.useUTF8()?this.decodeUTF8(this.fileName):this.decodeASCII(this.fileName);this.fileName.charAt(this.fileName.length-1)=="/"&&(this.isDir=!0);this.uncompressedSize===n.BinaryReader.MAX_VALUE_32BITS?this.parseZIP64ExtraField(t,i):t.skip(i);t.skip(u)},t.prototype.parseZIP64ExtraField=function(n,t){for(var r=0,u=t,f,i;r<u;){if(f=n.readInt(2),i=n.readInt(2),r+=4+i,f!=1){n.skip(i);continue}this.uncompressedSize=n.readInt64();n.skip(i-8);this.zip64=!0;break}n.skip(u-r)},t.prototype.isEncrypted=function(){return(this.bitFlag&1)==1},t.prototype.useUTF8=function(){return(this.bitFlag&2048)==2048},t.prototype.decodeUTF8=function(n){try{return decodeURIComponent(escape(n))}catch(t){return n}},t.prototype.decodeASCII=function(n){for(var r="",i,u=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "],t=0;t<n.length;t++)i=n.charCodeAt(t)&255,r+=i>127?u[i-128]:String.fromCharCode(i);return r},t}();n.ZipEntry=t})(t=n.Internal||(n.Internal={}))}(QZip||(QZip={})),function(n){var t=function(){function t(n,i,r){this.zip64=!1;this.files=[];this.onerror=function(n){alert(n);console.log(n)};typeof r=="function"&&(this.onerror=r);try{if(n===undefined||n===null)throw new Error("Zip file is required.");if(n.size<=t.EOCDR_MIN)throw new Error("Invalid zip file: "+n.name);this.file=n;this.name=n.name;this.size=n.size;this.onload=i;t.writeLog("Begin reading zip file: "+this.name);this.SeekEndOfCentral()}catch(u){this.onerror(u)}}return t.prototype.SeekEndOfCentral=function(){var r=new FileReader,n=this.file.size-t.EOCDR_BUF,i;n<0&&(n=0);i=this;t.writeLog("Seek start: "+n);r.onload=function(){try{if(i.CheckEndOfCentral(r.result,n))return;i.onerror(t.ERR_BAD_FORMAT+"End of Central Directory not found.")}catch(u){i.onerror(u)}};r.onerror=function(n){i.onerror(t.ERR_READ+"EOCDR I/O Error "+n)};r.readAsArrayBuffer(this.file.slice(n))},t.prototype.SeekCentral=function(){var n=new FileReader,i=this.centralDirOffset,r;if(this.file.size-i>t.CDR_MAX)throw new Error("There are too many entries in zip file than supported. Please reduce your zip file size.");r=this;t.writeLog("Seek start: "+i);n.onload=function(){try{r.readCentralDir(n.result,i)}catch(t){r.onerror(t)}};n.onerror=function(n){r.onerror(t.ERR_READ+"CDR I/O Error "+n)};n.readAsArrayBuffer(this.file.slice(i))},t.prototype.CheckEndOfCentral=function(i,r){this.reader=new n.Internal.BinaryReader(new Uint8Array(i),r);var u=this.reader.lastIndexOfSignature(t.CENTRAL_DIRECTORY_END,this.reader.length-t.EOCDR_MIN,this.reader.length-t.EOCDR_MAX);if(u===-1)return!1;if(t.writeLog("EOCDR found: "+u),this.buffer=i,this.reader.setIndex(u),this.checkSignature(t.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.centralDirOffset===n.Internal.BinaryReader.MAX_VALUE_32BITS){if(this.zip64=!0,t.writeLog("Zip64 detected."),u=this.reader.lastIndexOfSignature(t.ZIP64_CENTRAL_DIRECTORY_LOCATOR,u),u===-1)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(u);t.writeLog("EOCDR zip64 end found: "+u);this.checkSignature(t.ZIP64_CENTRAL_DIRECTORY_LOCATOR);u=this.readBlockZip64EndOfCentralLocator();this.reader.setIndex(u,!0);this.checkSignature(t.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral()}return this.SeekCentral(),!0},t.prototype.readBlockEndOfCentral=function(){this.reader.skip(12);this.centralDirOffset=this.reader.readInt(4);t.writeLog("Central Dir offset: "+this.centralDirOffset)},t.prototype.readBlockZip64EndOfCentral=function(){this.reader.skip(44);this.centralDirOffset=this.reader.readInt64();t.writeLog("Central Dir offset zip64: "+this.centralDirOffset)},t.prototype.readBlockZip64EndOfCentralLocator=function(){var r=this.reader.readInt(4),n=this.reader.readInt64(),i=this.reader.readInt(4);if(i>1)throw new Error("Multi-volumes zip are not supported.");return t.writeLog("EOCDR zip64 found: "+n),n},t.prototype.readCentralDir=function(i,r){for(this.reader&&this.reader.dispose(),this.buffer&&(this.buffer=null),this.buffer=i,this.reader=new n.Internal.BinaryReader(new Uint8Array(i),r),t.writeLog("Read central dir.");this.reader.readString(4)===t.CENTRAL_FILE_HEADER;){var u=new n.Internal.ZipEntry(this.reader,this.zip64);u.isDir||this.files.push(u)}if(typeof this.onload=="function")this.onload(this.files)},t.prototype.checkSignature=function(n){var t=this.reader.readString(4);if(t!==n)throw new Error("Corrupted zip or bug : unexpected signature ("+t+", expected "+n+")");},t.writeLog=function(n){t.DEBUG&&console.log(n)},t.EOCDR_MIN=22,t.EOCDR_MAX=65558,t.EOCDR_BUF=66560,t.CDR_MAX=268435455,t.ERR_BAD_FORMAT="Zip file format is not recognized. ",t.ERR_READ="Error while reading zip file. ",t.DEBUG=!0,t.CENTRAL_FILE_HEADER="PK\x01\x02",t.CENTRAL_DIRECTORY_END="PK\x05\x06",t.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07",t.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06",t}();n.ZipFile=t}(QZip||(QZip={}));
